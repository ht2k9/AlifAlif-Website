<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
<head>
<title>Sleep Quality</title>
<meta http-equiv="content-type" content="text/html; charset=iso-8859-1" />
<meta http-equiv="refresh" content="10">
<style media="all" type="text/css">
body{margin:0;padding:0;background:#bbd9ee;color:#000;font-family:tahoma,arial,sans-serif;font-size:16px}tr:hover{cursor: pointer;opacity: 0.5;}form{margin:0;padding:0}img{border:none}a{color:#060606;text-decoration:none}a:hover{text-decoration:underline}input{vertical-align:middle}.floatleft{float:left!important}.floatright{float:right!important}.clear{clear:both!important}.bold{font-weight:700!important}.normal{font-weight:400!important}.block{display:block!important}input.text,select,textarea{font-family:arial,sans-serif;color:#333;font-size:12px;vertical-align:middle}input.text{padding:1px 0 0 4px;height:14px;font-weight:400}#main{width:992px;margin:0 auto}#header{position:relative;width:992px;height:106px;background:url(/img/bg-header.gif) no-repeat left bottom}a.logo{position:absolute;top:5px;left:20px}#top-navigation{position:absolute;top:60px;left:20px;margin:0;padding:0;list-style:none}#top-navigation li{float:left;margin:0 3px 0 0;height:34px;background:url(/img/tab.gif) repeat-x top}#top-navigation li a{float:left;display:block;height:20px;line-height:19px;color:#606060;padding:4px 0 0 0}#top-navigation li span{float:left;background:url(/img/tab-left.gif) no-repeat left top}#top-navigation li span span{background:url(/img/tab-right.gif) no-repeat right top;padding:7px 10px 0 10px}#top-navigation li.active{padding:0;height:34px;background:url(/img/tab-active.gif) repeat-x top;margin-right:2px}#top-navigation li.active span{background:url(/img/tab-active-left.gif) no-repeat left top;height:34px}#top-navigation li.active span span{background:url(/img/tab-active-right.gif) no-repeat right top;height:23px;padding:11px 10px 0 10px;line-height:19px;color:#606060}#middle{float:left;width:967px;background:url(/img/bg-middle.gif) repeat-y left;padding:0 13px 0 12px}#left-column{float:left;padding:1px 14px 0 12px;width:151px}#right-column{float:right;padding:0 9px 0 0;width:133px}#center-column{float:left;width:614px;background:url(/img/bg-center-column.jpg) no-repeat left top;min-height:584px;padding:12px 16px 0 13px}* html #center-column{height:584px}#footer{float:left;width:100%;background:url(/img/bg-footer.gif) no-repeat;height:15px}#left-column a{color:#3e3e3e}#left-column h3{font-size:11px;margin:0;color:#fff;background:url(/img/bg-left-header.gif) no-repeat left top;height:25px;line-height:23px;padding:0 0 0 9px}ul.nav{margin:0 0 11px 0;border-bottom:2px solid #ff9600;background:#ecefe7;list-style:none;padding:0 2px}ul.nav li{padding:4px 4px 6px 5px;background:url(/img/bg-dotted.gif) repeat-x bottom}ul.nav a{padding:0 0 0 12px;background:url(/img/arrow.gif) no-repeat 0 4px}ul.nav a:hover{font-weight:700}ul.nav li.last{background:0 0}#left-column .link{display:block;width:142px;height:25px;background:url(/img/bg-left-link.gif);margin:0 0 4px 0;font-weight:700;padding:0 0 0 9px;line-height:25px;color:#60635a}.top-bar{float:left;width:603px;border-left:2px solid #f70;padding:0 0 0 9px;margin:0 0 4px 0}.top-bar h1{font:20px/21px verdana,sans-serif;color:#43729f;margin:0 0 4px 0}.top-bar a.button{float:right;display:block;width:75px;height:35px;text-align:center;color:#fff;text-transform:uppercase;font-weight:700;line-height:27px;background:url(/img/bg-orange-button.gif) no-repeat}.select-bar{clear:both;border-top:2px solid #f70;border-bottom:2px solid #f70;padding:5px 0 3px 0;margin:0 0 17px 0}.select-bar select{width:145px;margin:0 2px}div.table{float:left;position:relative;width:614px;margin:0 0 37px 0}table.listing{border-bottom:1px solid #9097a9;width:613px;padding:0;margin:0;border:1px solid #9097a9}table.listing th{border-top:0!important}table.listing th.full{border-left:0;border-right:0!important;text-align:left;text-transform:uppercase}div.table img.left{position:absolute;top:0;left:0}div.table img.right{position:absolute;top:0;right:1px}table.listing td,table.listing th{border:1px solid #fff;text-align:center}table.listing th{background:#9097a9;color:#fff;padding:5px}table.listing td{background:#d8d8d8;color:#000;padding:3px 5px}table.listing .bg td{background:#ececec}table.listing .white td{background:#fff}table.listing .first{border-left:0 solid #9097a9;text-align:left}table.listing .last{border-right:0 solid #9097a9}table.listing th.first{background:#9097a9 url(/img/bg-th-left.gif) no-repeat left top;border-left:0}table.listing th.last{background:#9097a9 url(/img/bg-th-right.gif) no-repeat right top;border-right:0}table.listing .style1{font-weight:700;color:#ff7a00}table.listing .style2{font-weight:700;padding-left:16px}table.listing .style3{padding-left:25px}table.listing .style4{padding-left:35px}table.form .last{padding:1px 0 1px 5px;text-align:left}table.form td,table.form th{padding-left:10px}table.form input.text{width:262px}div.table .select{float:right;margin:2px 1px 0 0;width:176px;height:25px;background:#9097a9 url(/img/bg-select.gif);color:#fff}div.table .select strong{float:left;padding:5px 0 0 5px}div.table .select select{float:right;width:78px;margin:2px 3px 0 0;text-align:right}#right-column .h{float:left;background:#7e878a;border:1px solid #b8b8b8;border-bottom:0;padding:3px 10px;color:#fff;text-transform:uppercase}#right-column .box{float:left;width:121px;padding:5px;border:1px solid #b8b8b8;background:#ebebeb;margin:0 0 15px 0}.buttons{clear:both;text-align:center;padding:30px 0 15px 0}.buttons input{margin:0 0 6px 0}.modal{display:none;position:fixed;z-index:1;padding-top:100px;left:0;top:0;width:100%;height:100%;overflow:auto;background-color:#000;background-color:rgba(0,0,0,.4)}.modal-content{background-color:#fefefe;margin:auto;padding:20px;border:1px solid #888;width:603px}.close{color:#aaa;float:right;font-size:28px;font-weight:700}.close:focus,.close:hover{color:#000;text-decoration:none;cursor:pointer}
</style>
</head>
<body>
<div id="main">
  <div id="header"> <a href="#" class="logo"><img src="/img/logo.png" width="176" height="51" alt=""/></a>
    <ul id="top-navigation">
      <li class="active"><span><span>Research Results</span></span></li>
      <li><span><span><a href="/research/users">Participants</a></span></span></li>
    </ul>
  </div>
  <div id="middle">
    <div id="left-column"> <strong class="h"></strong>
      <div class="box">Real-time user tracking - updates every 15 minutes </div>
    </div>
    <div id="center-column">
      <div class="top-bar"> <a href="#" class="button" onclick="fnExcelReport();">Export</a>
        <h1>Research results</h1>
        <div class="breadcrumbs">Total: <%= research.length %></div>
        <input type="date" name="" id="" style="margin: 5px 0px; float: right;" onchange="dateFilter(event);">
      </div>
      <br/>
      <div class="select-bar">
        <h5 style="display: inline;">Light Sleep: <%= lightSleep %>min</h5>
        <h5 style="display: inline; margin-left: 30px;">Deep Sleep: <%= deepSleep %>min</h5>
        <h5 style="display: inline; margin-left: 30px;">Total Sleep: <%= totalSleep %>min</h5>      
        <br>
        <h5 style="display: inline;">Noise: <%= noiseAvg %>dB</h5>
        <h5 style="display: inline; margin-left: 30px;">Light: <%= lightAvg %>lux</h5>
      </div>
      <div class="table"> <img src="/img/bg-th-left.gif" width="8" height="7" alt="" class="left" /> <img src="/img/bg-th-right.gif" width="7" height="7" alt="" class="right" />
        <table id="headerTable" class="listing" cellpadding="0" cellspacing="0">
          <tr>
	    <% if(userID) { %> <th>Participant</th> <% } %>
            <th>Hour</th>
            <th>Noise (dB)</th>
            <th>Light (lux)</th>            
          </tr>
         
            <% for(let i=sortedResearch.length-1; i>=0; i--) { const ree = sortedResearch[i]; %>
              <tr onclick="showData('<%= ree.time %>')">
                <% if(userID){ %> <td><%= userID %></td> <% } %>
                <td><%= ree.time %> </td>
                <td><%= ree.noise.toFixed(2) %>dB</td>
                <td><%= ree.light.toFixed(2) %>lux</td>
                
              </tr>
            <% } %>
          
        </table>
        <div class="select"> <strong>Page: </strong>
          <select>
            <option>1</option>
          </select>
        </div>
      </div>
    </div>

    <div id="right-column">
      <h3>Participants</h3>
      <ul class="nav">
        <% for(let i=0; i<users.length; i++) { const user = users[i]; %>
          <li><a href="/research/<%= user.id %>"><%= user.id %> - <%= user.username %></a></li>
        <% } %>
      </ul>

  </div>
  <div id="footer"></div>
  <iframe id="txtArea1" style="display:none"></iframe>

  <div id="myModal" class="modal">

    <!-- Modal content -->
    <div class="modal-content">
      <span class="close">&times;</span>
      <table id="headerTable" class="listing" cellpadding="0" cellspacing="0">
        <tr>
          <th class="first" width="177">Participant ID</th>
          <th>Time</th>
          <th>Noise (dB)</th>
          <th>Light (lux)</th>
        </tr>
       
          <% for(let i=research.length-1; i>=0; i--) { const ree = research[i]; %>
            <tr class="row<%= Number.parseInt(research[i].time.split(':')[0]) %>" style="display: none;">
              <td class="first style2"><%= ree.user %></td>
              <td><%= ree.time %> </td>
              <td><%= ree.noise %>dB</td>
              <td><%= ree.light %>lux</td>
            </tr>
          <% } %>
        
      </table>
    </div>

  </div>
</div>
</body>
<script>

  let currentId = 0;

  function showData(id){
    modal.style.display = "table-row";
    currentId = id;

    var appBanners = document.getElementsByClassName('row'+id);

    for (var i = 0; i < appBanners.length; i ++) {
        appBanners[i].style.display = 'table-row';
    }
  }

  var modal = document.getElementById("myModal");
  var span = document.getElementsByClassName("close")[0];

  span.onclick = function() {
    modal.style.display = "none";
    var appBanners = document.getElementsByClassName('row'+currentId);

    for (var i = 0; i < appBanners.length; i ++) {
        appBanners[i].style.display = 'none';
    }
  }

  window.onclick = function(event) {
    if (event.target == modal) {
        modal.style.display = "none";
        var appBanners = document.getElementsByClassName('row'+currentId);

      for (var i = 0; i < appBanners.length; i ++) {
          appBanners[i].style.display = 'none';
      }
    }
  }

  function fnExcelReport()
  {
    var tab_text="<table border='2px'><tr bgcolor='#87AFC6'>";
    var textRange; var j=0;
    tab = document.getElementById('headerTable'); // id of table

    for(j = 0 ; j < tab.rows.length ; j++) 
    {     
        tab_text=tab_text+tab.rows[j].innerHTML+"</tr>";
        //tab_text=tab_text+"</tr>";
    }

    tab_text=tab_text+"</table>";
    tab_text= tab_text.replace(/<A[^>]*>|<\/A>/g, "");//remove if u want links in your table
    tab_text= tab_text.replace(/<img[^>]*>/gi,""); // remove if u want images in your table
    tab_text= tab_text.replace(/<input[^>]*>|<\/input>/gi, ""); // reomves input params

    var ua = window.navigator.userAgent;
    var msie = ua.indexOf("MSIE "); 

    if (msie > 0 || !!navigator.userAgent.match(/Trident.*rv\:11\./))      // If Internet Explorer
    {
        txtArea1.document.open("txt/html","replace");
        txtArea1.document.write(tab_text);
        txtArea1.document.close();
        txtArea1.focus(); 
        sa=txtArea1.document.execCommand("SaveAs",true,"Say Thanks to Sumit.xls");
    }  
    else                 //other browser not tested on IE 11
        sa = window.open('data:application/vnd.ms-excel,' + encodeURIComponent(tab_text));  

    return (sa);
  }

  function dateFilter(e){
    console.log(e.target.value);
    window.location = '/research/filter/'+e.target.value;
  }
</script>
</html>
